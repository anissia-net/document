# 애니메이션 순위
- 이 문서는 애니시아의 애니메이션 순위 집계 기준에 대한 문서이다.

## 공통사항
- ### 수집방법
  - **애니메이션 편성표**에서 애니메이션을 클릭한 경우.
  - 애니시아의 **애니 정보** 매뉴에서 애니메이션을 클릭한 경우.
- ### 수집항목
  - 애니메이션 고유번호
  - 클릭을 실행한 IP 주소
  - 클릭한 시간정보
- ### 수집기간
  - 합산이 완료되면 합산기간내 수집항목 (애니메이션 고유번호, IP주소, 클릭시간) 은 모두 삭제된다.
  - 합산은 배치에 오류가 발생하거나 수동으로 실행시킨 경우를 제외하면 매 시간 1분에 작동한다.
- ### 합산방법
  - 매 시간 1분에 이전 시간까지의 시간구역[예) 02시, 03시]별 IP 중복이 제거된 클릭 로그의 합산한다.
    - 예를들어 다음과 같이 클릭 했을때 **애니A (1회)**, **애니B (3회)** 가 된다. 
        - [**02**:03] (1.1.1.1) **애니A** 클릭 [유효]
        - [**02**:04] (1.1.1.1) **애니A** 클릭 [무효] IP 중복
        - [**02**:05] (1.1.1.1) **애니A** 클릭 [무효] IP 중복
        - [**02**:59] (1.1.1.1) **애니B** 클릭 [유효]
        - [**03**:00] (1.1.1.1) **애니B** 클릭 [유효] IP 는 중복되지만 시간[02시 != 03시]이 다름
        - [**03**:05] (2.2.2.2) **애니B** 클릭 [유효] IP 가 다름

## 집계 기준
- ### 일간
  - 기준시간은 최근 1일(24시간) 이다.
  - 순위 변동은 최근 7일(168시간) 순위와 비교한다.
- ### 주간
  - 기준시간은 최근 7일(168시간) 이다.
  - 순위 변동은 최근 28일(672시간) 순위와 비교한다.
- ### 월간
  - 기준시간은 최근 28일(672시간) 이다.
      - 한달의 기준을 28일로 잡은 이유는 애니메이션이 7일 주기로 반영되기 때문에 7로 나누어 떨어져야 정확한 순위가 나오기 때문이다.
      - 예를들어 30일을 기준으로 잡을경우, 오늘이 화요일이고 했을 때 **월/화**는 최근 **5주**간, **수/목/금/토/일** 은 최근 **4주**간의 히트를 합산한다.
  - 순위 변동은 최근 48일(1152시간) 순위와 비교한다.
    
## 참고
- [애니메이션 순위 구현 메인코드](https://github.com/anissia-net/anissia-core/blob/master/anissia-app-external-api/src/main/kotlin/anissia/services/AnimeRankService.kt)
- [애니메이션 순위 합산 스케줄링](https://github.com/anissia-net/anissia-core/blob/master/anissia-app-external-api/src/main/kotlin/anissia/configruration/ScheduleConfiguration.kt)
